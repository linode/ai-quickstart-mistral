# Implementation Plan: One-Click AI Sandbox

**Branch**: `001-ai-sandbox` | **Date**: 2025-11-12 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-ai-sandbox/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Deploy a complete, pre-configured AI inference stack as a Linode Marketplace App. The solution automatically installs NVIDIA drivers, Docker, and launches two containerized services (vLLM API server and Open WebUI chat interface) within 5 minutes of instance boot. Uses a custom "Golden Image" base with StackScript deployment logic for fast, reliable one-click deployment.

**Development Priority**: Independent deployment via Linode API/CLI comes FIRST to enable development, testing, and demonstration. Marketplace integration follows after we have a working system to show the Marketplace team.

## Technical Context

**Language/Version**: Bash (StackScript), YAML (Docker Compose), Python (containerized services)  
**Primary Dependencies**: 
- Docker Engine (latest stable)
- Docker Compose v2
- NVIDIA Drivers (latest stable, Linode kernel-compatible)
- vLLM OpenAI API server (`ghcr.io/vllm-project/vllm-openai:latest`)
- Open WebUI (`ghcr.io/open-webui/open-webui:main`)
- Ubuntu 22.04 LTS (base OS)

**Storage**: 
- Model cache: `/opt/models` (host directory, persisted)
- Chat history: `/opt/open-webui` (host directory, persisted)
- Configuration: `/opt/ai-sandbox/docker-compose.yml` (generated by StackScript)

**Testing**: 
- Manual deployment testing on clean Linode GPU instances
- Independent deployment via Linode API/CLI (not requiring Marketplace UI)
- Integration tests: verify services start, API responds, UI accessible
- Contract tests: OpenAI API v1 compatibility validation
- Development workflow: Build, deploy, and test independently of Marketplace

**Target Platform**: Linode GPU instances (Ubuntu 22.04 LTS), Marketplace App deployment  
**Project Type**: Infrastructure/Deployment (Marketplace App)  
**Performance Goals**: 
- Deployment completion: <5 minutes from instance boot to working services
- API response time: Sequential processing (queued requests)
- Service startup: Automatic on boot, auto-restart on failure

**Constraints**: 
- **Instance Types**: RTX4000 instances only (g2-gpu-rtx4000a* series)
- **Regions**: Limited to RTX4000-available regions:
  - Chicago, US (us-ord)
  - Frankfurt 2, DE (de-fra-2)
  - Osaka, JP (jp-osa)
  - Paris, FR (fr-par)
  - Seattle, WA, US (us-sea)
  - Singapore 2, SG (sg-sin-2)
- **User Experience**: Interactive prompts for region and instance size selection (with command-line parameter support)
- Must complete deployment within 5 minutes (constitution requirement)
- Must provide clear error messages in `/etc/motd` on failures
- Must display security warnings prominently
- Services must be containerized (Docker Compose)

**Scale/Scope**: 
- Single-instance deployment (one model per instance)
- Sequential request processing (no parallel inference)
- Default model: `mistralai/Mistral-7B-Instruct-v0.3`
- Target: 95% successful deployments without manual intervention

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### I. Security-First (NON-NEGOTIABLE) ✅
- **Requirement**: Security warnings in `/etc/motd`, firewall guidance in documentation
- **Compliance**: StackScript writes security warnings to `/etc/motd` (FR-013, FR-019). Documentation includes firewall configuration guidance.
- **Status**: PASS

### II. One-Click Deployment Reliability ✅
- **Requirement**: <5 minutes deployment, automatic installation, clear error messages
- **Compliance**: StackScript automates all installation (FR-002). Error handling via `/etc/motd` (FR-019). Target: 5 minutes (FR-004, SC-001).
- **Status**: PASS

### III. Documentation & User Experience ✅
- **Requirement**: Clear step-by-step docs, tested documentation, examples
- **Compliance**: `/etc/motd` provides access instructions (FR-012). `quickstart.md` will include deployment and usage examples.
- **Status**: PASS

### IV. Testing & Validation ✅
- **Requirement**: Test on clean instances, integration tests, health checks
- **Compliance**: Testing strategy includes clean instance deployment tests and integration validation. Service health verified via API/UI accessibility.
- **Status**: PASS

### V. Maintainability & Observability ✅
- **Requirement**: Containerized services, Docker Compose, accessible logging, externalized config
- **Compliance**: All services containerized via Docker Compose. Configuration externalized (environment variables, docker-compose.yml). Logging accessible via `docker-compose logs`.
- **Status**: PASS

**Overall Status**: ✅ ALL GATES PASS - Proceed to Phase 0

### Post-Design Re-Evaluation (After Phase 1)

**Status**: ✅ ALL GATES STILL PASS

**Design Decisions Validated**:
- ✅ Docker Compose architecture satisfies containerization requirement (Principle V)
- ✅ `/etc/motd` error messaging satisfies user guidance requirement (Principle III)
- ✅ StackScript automation satisfies deployment reliability requirement (Principle II)
- ✅ Security warnings in `/etc/motd` satisfy security-first requirement (Principle I)
- ✅ Testing strategy includes clean instance validation (Principle IV)

**No violations introduced by design decisions.**

## Project Structure

### Documentation (this feature)

```text
specs/001-ai-sandbox/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
stackscripts/
└── ai-sandbox.sh        # Linode StackScript for deployment automation

images/
└── golden-image/         # Custom image build scripts and configuration
    ├── Dockerfile        # Base image preparation (if needed)
    └── build.sh          # Image build automation

docker/
└── docker-compose.yml.template  # Template for generated docker-compose.yml

docs/
├── deployment.md         # Deployment instructions
├── troubleshooting.md    # Error handling and troubleshooting
└── security.md          # Security configuration guide

scripts/
├── test-deployment.sh   # Automated deployment testing
├── validate-services.sh # Service health validation
├── deploy-direct.sh     # Deploy StackScript directly to Linode (independent of Marketplace)
├── run-stackscript.sh   # Run StackScript on existing Linode instance
└── create-instance.sh   # Create Linode GPU instance via API/CLI for testing
```

**Structure Decision**: This is an infrastructure/deployment project (Marketplace App), not a traditional application. The structure focuses on deployment automation (StackScripts), container orchestration (Docker Compose), and documentation. No traditional application source code structure needed.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

No violations - all constitution principles are satisfied by the design approach.
